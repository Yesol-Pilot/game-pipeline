# 마스터룰: 초자동화 게임 개발 파이프라인

## 📋 프로젝트 개요

트렌드 데이터(틱톡, 구글 트렌드)를 자동 수집·분석하여 게임 기획안(GDD)을 생성하고, 운영자 승인 후 Godot 엔진으로 게임을 자동 빌드하는 엔드-투-엔드(End-to-End) 파이프라인.

---

## 🏗️ 아키텍처 원칙: 리스킨 중심 설계 (Reskin-First Architecture)

### 3계층 분리
| 계층 | 역할 | AI 접근 |
|------|------|---------|
| **코어 로직** (`_core/`) | 게임 규칙, 물리, 상태 관리 | ⛔ 수정 금지 |
| **데이터/설정** (`configs/`, `skins/`) | 변수, 에셋 경로, 스킨 정의 | ✅ 주 활동 영역 |
| **프레젠테이션** | 시각 요소, 사운드, UI | ✅ 교체 가능 |

### 핵심 설계 원칙
- **컴포넌트 기반(Composition)**: 상속보다 구성 우선
- **데이터 주도(Data-Driven)**: 모든 변수는 `.tres` 리소스로 외부화
- **이벤트 버스(EventBus)**: 계층 간 시그널 기반 통신

---

## 🔤 언어 규칙 (필수)

> [!IMPORTANT]
> **모든 문서, 주석, 커밋 메시지, 계획서, 코드 주석은 반드시 한국어(한글)로 작성한다.**
> 영문 용어가 필요한 경우 한국어 번역을 우선 표기하고 괄호 안에 원문을 병기한다.
> 예: `게임 기획 문서(GDD)`, `헤드리스(Headless)`, `웹훅(Webhook)`

---

## 📁 폴더 구조

```
d:\agenttest\
├── core/                       # 핵심 시스템 (공통 모듈)
│   ├── crawler/                # 데이터 수집 모듈
│   ├── analyzer/               # 트렌드 분석 모듈
│   ├── gdd_generator/          # GDD 생성 모듈
│   ├── asset_pipeline/         # 자산 생성 파이프라인
│   ├── orchestrator/           # n8n 워크플로우 설정
│   └── builder/                # Godot 빌드 자동화
│
├── games/                      # 게임 프로젝트 (종류별 분류)
│   ├── runner/                 # 러너 게임류
│   ├── puzzle/                 # 퍼즐 게임류
│   ├── clicker/                # 클리커 게임류
│   └── {game_type}/            # 추가 게임 유형...
│
├── templates/                  # Godot 게임 템플릿
├── schemas/                    # JSON 스키마 정의
├── config/                     # 환경 설정 파일
└── MASTER_RULES.md             # 본 문서
```

---

## 🔄 파이프라인 4단계

| 단계 | 설명 | 구성 요소 |
|------|------|-----------|
| **1. 인제스천** | 트렌드 데이터 수집 | 틱톡 크롤러, 구글 트렌드 API |
| **2. 합성** | GDD 자동 생성 | LLM + JSON 스키마 |
| **3. 검증** | 운영자 승인 | n8n + 슬랙(Slack) HITL |
| **4. 실행** | 게임 빌드 | Godot 헤드리스 빌드 |

---

## 📐 핵심 규칙

### 1. 데이터 수집 규칙
- 틱톡 스크래핑 시 **주거용 프록시(Residential Proxy)** 필수 사용
- **Playwright** 또는 **Selenium** 기반 브라우저 자동화 사용
- `playwright-stealth` 플러그인으로 탐지 회피
- 2개 이상 소스(틱톡 + 구글 트렌드)로 **교차 검증**

### 2. GDD 생성 규칙
- 모든 GDD는 **정의된 JSON 스키마** 준수 필수
- 필수 필드: `game_title`, `core_loop`, `mechanics`, `art_style`, `assets_required`, `monetization`
- 캐릭터 일관성을 위한 `character_dna` 필드 포함
- **Few-Shot 프롬프팅** 기법으로 스키마 준수 유도

### 3. Human-in-the-Loop (HITL) 규칙
- 모든 GDD는 **슬랙을 통한 운영자 승인** 후에만 빌드 진행
- 슬랙 요청에 대한 **HMAC 서명 검증** 필수
- 승인/반려 버튼을 통한 명시적 워크플로우 제어

### 4. Godot 빌드 규칙
- **템플릿 기반 주입(Template-based Injection)** 방식 사용
- 새 자산 적용 시 `godot --headless --editor --quit` 명령으로 **헤드리스 임포트 트리거** 실행
- 자산 명명 규칙 준수: `player_sprite.png`, `bg_music.ogg` 등

### 5. 자산 생성 규칙
- **스타일 참조(Style Reference)** 파라미터로 시각적 일관성 유지
- `style_strength` 값: 0.3 ~ 0.6 범위 권장
- `negative_prompt`에 "blurry, inconsistent, mixed styles" 고정 삽입
- 스프라이트 시트 생성 시 투명 배경(RGBA) 후처리

### 6. 보안 규칙
- 외부 웹훅 수신 시 **HMAC SHA-256 서명 검증** 필수
- JSON 페이로드 **스키마 검증** 후 내부 로직 실행
- 로컬 터널링(Ngrok 등) 사용 시 접근 제한 설정

---

## 📝 명명 규칙

| 항목 | 규칙 | 예시 |
|------|------|------|
| 게임 프로젝트 폴더 | `{일자}_{트렌드키워드}` | `20260110_댄스챌린지` |
| GDD 파일 | `gdd_{게임이름}.json` | `gdd_달리기왕.json` |
| 자산 파일 | `{역할}_{설명}.{확장자}` | `player_idle.png` |
| 템플릿 | `template_{게임유형}` | `template_runner` |

---

## ✅ 체크리스트

신규 게임 생성 시 확인 사항:

- [ ] 트렌드 데이터 수집 완료
- [ ] 교차 검증(틱톡 + 구글 트렌드) 완료
- [ ] GDD JSON 스키마 유효성 검증 완료
- [ ] 운영자 슬랙 승인 완료
- [ ] 템플릿 선택 완료
- [ ] 자산 생성 및 스타일 일관성 확인
- [ ] 헤드리스 임포트 트리거 실행
- [ ] 최종 빌드(APK/HTML5) 생성
